name: Banner Swap (3-way)
on:
  schedule:
    - cron: '0 */5 * * *'    # runs every 5 hours; change as needed
  workflow_dispatch:
    inputs:
      force:
        description: "Optional: force one of morning/afternoon/night"
        required: false
        default: "afternoon"

jobs:
  swap:
    runs-on: ubuntu-latest
    env:
      TZ: 'Asia/Kolkata'               # change to your timezone
      ASSETS_DIR: 'assets'
      TARGET: 'banner.png'
      MORNING: 'morning.png'
      AFTERNOON: 'afternoon.png'
      NIGHT: 'night.png'
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Select image (3-way)
        env:
          FORCE: ${{ github.event.inputs.force }}
        run: |
          HOUR=$(TZ=$TZ date +'%H')
          echo "TZ=$TZ hour=$HOUR force=$FORCE"
          if [ -n "$FORCE" ]; then
            case "$FORCE" in
              morning) SRC="$ASSETS_DIR/$MORNING" ;;
              afternoon) SRC="$ASSETS_DIR/$AFTERNOON" ;;
              night) SRC="$ASSETS_DIR/$NIGHT" ;;
              *) echo "Invalid force value: $FORCE"; exit 1 ;;
            esac
          else
            if [ "$HOUR" -ge 0 ] && [ "$HOUR" -lt 8 ]; then
              SRC="$ASSETS_DIR/$NIGHT"
            elif [ "$HOUR" -ge 8 ] && [ "$HOUR" -lt 16 ]; then
              SRC="$ASSETS_DIR/$MORNING"
            else
              SRC="$ASSETS_DIR/$AFTERNOON"
            fi
          fi
          cp "$SRC" "$ASSETS_DIR/$TARGET"
          echo "Copied $SRC -> $ASSETS_DIR/$TARGET"

      - name: Commit & push if changed
        env:
          FORCE: ${{ github.event.inputs.force }}
        run: |
          git config user.name "Banner Bot"
          git config user.email "banner-bot@users.noreply.github.com"
          git add "$ASSETS_DIR/$TARGET"

          # recompute hour so commit message reflects actual time if not forced
          HOUR=$(TZ=$TZ date +'%H')

          if [ -n "$FORCE" ]; then
            case "$FORCE" in
              morning) MSG="Good Morning!" ;;
              afternoon) MSG="Good Afternoon!" ;;
              night) MSG="Good Night!" ;;
              *) MSG="Update banner" ;;
            esac
          else
            if [ "$HOUR" -ge 0 ] && [ "$HOUR" -lt 8 ]; then
              MSG="Good Night!"
            elif [ "$HOUR" -ge 8 ] && [ "$HOUR" -lt 16 ]; then
              MSG="Good Morning!"
            else
              MSG="Good Afternoon!"
            fi
          fi

          git commit -m "$MSG" || echo "no changes to commit"
          git push